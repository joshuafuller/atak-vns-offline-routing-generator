# ğŸ—ºï¸ ATAK VNS Offline Routing Generator

**Automated generation of VNS-compatible offline routing files for any Geofabrik region**

[![Docker](https://img.shields.io/badge/Docker-Required-2496ED?style=flat-square&logo=docker)](https://www.docker.com/)
[![License](https://img.shields.io/badge/License-MIT-green?style=flat-square)](LICENSE)
[![ATAK](https://img.shields.io/badge/ATAK-VNS%20Plugin-orange?style=flat-square)](https://tak.gov/)

## ğŸ“‹ Overview

This tool automates the creation of VNS-compatible offline routing files for any region available on [Geofabrik](https://download.geofabrik.de/), transforming a complex multi-step manual process into a single command.

The VNS (Visual Navigation System) plugin for ATAK requires specific GraphHopper v1.0 routing data with precise file structures. This generator handles all the complexity:

### ğŸ”¥ Critical for Emergency Operations
**Perfect for wildfire operations, search & rescue, and remote deployments where internet connectivity is unavailable or unreliable.** While VNS can use Google Maps API for real-time traffic and road closures, this offline data ensures navigation capabilities when teams are beyond cellular coverage.

**Key Benefits:**
- **Zero connectivity required** - Works completely offline
- **Reliable in emergencies** - No dependence on cell towers or internet
- **Pre-positioned data** - Deploy with confidence knowing routing will work
- **Complements online routing** - Use alongside Google API when connectivity allows

- âœ… Downloads latest OSM data from Geofabrik
- âœ… Processes data with GraphHopper v1.0 (VNS-compatible version)
- âœ… Creates proper VNS folder structure and files
- âœ… Generates ZIP files for easy device transfer
- âœ… Provides clear installation instructions

## ğŸš€ Quick Start

### Prerequisites
- **Docker** installed and running on your system ([Download Docker](https://www.docker.com/get-started))

### Usage
1. Clone or download this repository
2. Open a terminal in the project directory
3. Make scripts executable (macOS/Linux only):
   ```bash
   chmod +x run.sh
   ```
4. Generate routing data for any Geofabrik region:
   ```bash
   # Examples
   ./run.sh us/california
   ./run.sh germany
   ./run.sh india
   ```
5. Need help finding a region path? List all available downloads:
   ```bash
   ./list-regions.sh
   ```

### Processing Times (Tested)
| Region Size | Example | Processing Time | Output Size |
|-------------|---------|-----------------|-------------|
| Small | Malta | ~10 seconds | ~2.6 MB |
| Small | Delaware | ~17 seconds | ~9.1 MB |
| Medium | Tennessee | ~3-5 minutes | ~80 MB |
| Large | Texas/California | ~10+ minutes | ~260+ MB |

## ğŸ“± Installing on Your Android Device

After generation completes, you'll have:
- ğŸ“ **Folder**: `./output/[region-name]/` - Raw routing data
- ğŸ“¦ **ZIP file**: `./output/[region-name].zip` - Compressed for transfer

### Installation Steps:
1. **Transfer** the ZIP file to your Android device
2. **Extract** the ZIP to get the region folder
3. **Copy** the entire folder to your device at:
   ```
   /storage/emulated/0/atak/tools/VNS/GH/[region-name]/
   ```
   OR
   ```
   Internal Storage/atak/tools/VNS/GH/[region-name]/
   ```

### Required Folder Structure on Device:
```
Internal Storage/
â””â”€â”€ atak/
    â””â”€â”€ tools/
        â””â”€â”€ VNS/
            â””â”€â”€ GH/
                â”œâ”€â”€ california/      â† Your generated routing data
                â”œâ”€â”€ texas/           â† Additional regions
                â””â”€â”€ florida/         â† VNS detects all folders here
```

## ğŸ› ï¸ How It Works

### VNS Routing Architecture Overview
The ATAK VNS (Vehicle Navigation System) supports two types of routing:

1. **ğŸŒ Online Routing** - Uses private routing servers (OSRM) with real-time data
2. **ğŸ“± Offline Routing** - Uses local GraphHopper files for zero-connectivity operations

**This tool generates the offline routing data** that gets installed directly on ATAK devices.

### The Complete VNS Ecosystem
According to official VNS documentation, a full routing system includes:

**Server Components** (Not covered by this tool):
- Private routing server using OSRM (Open Source Routing Machine)
- OAuth2 authentication and user management
- API endpoints for real-time routing requests
- Docker Compose orchestration

**Client Components** (Generated by this tool):
- GraphHopper v1.0 routing data files
- Regional boundary files (.poly, .kml)
- Timestamp metadata for data freshness
- VNS-compatible folder structure

### Our Tool's Process
This generator automates the "offline routing data" portion:

1. **Download**: Fetches latest OSM data (.osm.pbf), boundary files (.poly, .kml) from Geofabrik
2. **Process**: Runs GraphHopper v1.0 import with optimized memory settings (4GB heap)
3. **Structure**: Creates VNS-compatible folder structure with all required files
4. **Package**: Generates both folder and ZIP file outputs

### Why Offline Routing Matters
- **Emergency Operations**: Wildfire, search & rescue, disaster response
- **Remote Deployments**: Beyond cellular coverage areas
- **Mission Critical**: No dependency on external infrastructure
- **Redundancy**: Backup when private routing servers are unavailable

### Generated Files:
```
[region-name]/
â”œâ”€â”€ [region-name].kml          â† KML boundary file
â”œâ”€â”€ [region-name].poly         â† POLY boundary file
â”œâ”€â”€ [region-name].timestamp    â† Region-named timestamp
â”œâ”€â”€ timestamp                 â† Generic timestamp
â”œâ”€â”€ edges                     â† GraphHopper routing data
â”œâ”€â”€ geometry                  â† Binary routing files
â”œâ”€â”€ location_index            â† Location index data
â”œâ”€â”€ nodes                     â† Node data
â”œâ”€â”€ nodes_ch_car              â† Car-specific node data
â”œâ”€â”€ properties                â† Graph properties
â”œâ”€â”€ shortcuts_car             â† Car routing shortcuts
â”œâ”€â”€ string_index_keys         â† String index keys
â””â”€â”€ string_index_vals         â† String index values
```

## ğŸ—ï¸ Project Structure

```
atak-vns-offline-routing-generator/
â”œâ”€â”€ README.md              â† This file
â”œâ”€â”€ Dockerfile             â† Docker container definition
â”œâ”€â”€ run.sh                 â† Main entry point script
â”œâ”€â”€ generate-data.sh       â† Core data processing script
â””â”€â”€ output/                â† Generated routing data (created after first run)
    â”œâ”€â”€ [region-name]/      â† VNS-ready folder
    â””â”€â”€ [region-name].zip   â† Compressed archive
```

## âš™ï¸ Technical Details

### Dependencies (Handled by Docker):
- **OpenJDK 8** - Required by GraphHopper v1.0
- **Maven 3** - For building GraphHopper from source
- **GraphHopper v1.0** - Specific version compatible with VNS
- **wget** - For downloading OSM data
- **zip** - For creating compressed archives

### Memory Requirements:
- **Minimum**: 4GB RAM (configured automatically)
- **Recommended**: 8GB+ RAM for large regions like California or Texas

### Listing Available Regions
Run `./list-regions.sh` to display the ~500 region paths published by Geofabrik. Use any of these paths with `run.sh` to generate data.

### Data Freshness:
This tool generates routing data from the latest available OpenStreetMap data via Geofabrik (typically updated weekly). For real-time conditions like:
- **Road closures** (accidents, construction, emergencies)  
- **Live traffic conditions**
- **Temporary restrictions**

VNS can be configured to use Google Maps API when internet is available. The offline data generated by this tool serves as the essential fallback for when connectivity is lost.

### Official VNS Process (What This Tool Automates):
According to VNS documentation, manually creating offline routing data requires:

1. **Data Collection**:
   - Download `.osm.pbf` files from Geofabrik
   - Obtain matching `.poly` boundary files
   - Generate `.kml` files from `.poly` files using border utilities
   - Create `.timestamp` files with ISO8601 timestamps

2. **Processing Environment Setup**:
   - Install Docker and Java
   - Build custom GraphHopper v1.0 Docker container
   - Configure memory settings and build parameters
   - Handle version compatibility issues

3. **GraphHopper Processing**:
   - Run `gh_dataprep` Docker container
   - Execute GraphHopper import with correct config
   - Generate `.ghz` region files (server format)
   - Create proper directory structures

4. **File Organization**:
   - Structure data for VNS consumption
   - Include all required metadata files
   - Ensure proper naming conventions

**This tool automates all these steps** into a single command, ensuring consistency and eliminating manual configuration errors.

## ğŸ”§ Advanced Usage

### Custom Docker Build:
```bash
# Rebuild Docker image with latest changes
docker build -t vns-data-generator:1.0 .

# Run with custom memory settings
docker run --rm -v "$(pwd)/output:/app/output" \
    -e JAVA_OPTS="-Xmx8192m -Xms8192m" \
    vns-data-generator:1.0 ./generate-data.sh california
```

### Batch Processing Multiple Regions:
```bash
# Process multiple regions
for region in north-america/us/california europe/germany; do
    ./run.sh $region
done
```

## ğŸ› Troubleshooting

### Common Issues:

**"Docker not found"**
- Install Docker and ensure it's running
- On Windows: Restart after Docker installation

**"Permission denied"**
- On macOS/Linux: Run `chmod +x run.sh`
- On Windows: Use PowerShell or Git Bash

**"Out of memory errors"**
- Large regions need significant RAM
- Close other applications
- Consider processing smaller regions first

**"Network timeouts"**
- Check internet connection
- Geofabrik servers may be busy - retry later

 **"VNS not detecting routing data"**
 - Ensure folder is copied to exact path: `/storage/emulated/0/atak/tools/VNS/GH/[region-name]/`
 - Check that all required files are present (see Generated Files section)
- Restart ATAK after copying new routing data

### Debug Mode:
```bash
# Run with verbose output
docker run --rm -v "$(pwd)/output:/app/output" \
    vns-data-generator:1.0 bash -x ./generate-data.sh california
```

## ğŸ“„ License

MIT License - see [LICENSE](LICENSE) file for details.

## ğŸ¤ Contributing

Contributions welcome! Please feel free to submit issues and pull requests.

### Development Setup:
1. Fork the repository
2. Make your changes
3. Test with a small region (Delaware recommended)
4. Submit a pull request

## ğŸ“ Support

- **Issues**: Open a GitHub issue
- **ATAK/VNS Questions**: Consult official ATAK documentation
- **GraphHopper Questions**: See [GraphHopper documentation](https://www.graphhopper.com/)

## âš ï¸ Disclaimer

This tool is for legitimate navigation and mapping purposes only. Users are responsible for complying with all applicable laws and terms of service for the data sources used.

---

**Made with â¤ï¸ for the ATAK community**